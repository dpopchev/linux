- name: "Sub | Preserve selected bashrc configs"
  tags: [setup, bash-setup]
  ansible.builtin.include_role:
    name: backup
  vars:
    backup_target: "{{ item.dest }}"
  loop: "{{ bash_bashrc_dotfiles }}"
  loop_control:
    label: "{{ item.dest }}"
  when: item.should_backup

- name: "Sub | Copy bashrc templates"
  tags: [setup, bash-setup]
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    force: true
    follow: false
    mode: '751'
  loop: "{{ bash_bashrc_dotfiles }}"
  loop_control:
    label: "{{ item.dest }}"
  when: item.kind == "template"

- name: "Sub | Copy bashrc files"
  tags: [setup, bash-setup]
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    force: true
    follow: false
    mode: '751'
  loop: "{{ bash_bashrc_dotfiles }}"
  loop_control:
    label: "{{ item.dest }}"
  when: item.kind == "file"

- name: "Sub | Link bashrc files"
  tags: [setup, bash-setup]
  ansible.builtin.file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    state: link
    force: true
    follow: false
  loop: "{{ bash_bashrc_dotfiles }}"
  loop_control:
    label: "{{ item.dest }}"
  when: item.kind == "link"

- name: Install bash completion package
  tags: [packages, bash-packages]
  ansible.builtin.package:
    state: present
    name: bash-completion
  become: true
